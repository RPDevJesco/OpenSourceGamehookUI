<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>GameHook Tracking Over World Stat Values</title>

</head>

<body>
<div id="app">
  <div v-if="ready == false">
    Loading...
  </div>
  <div v-else>
    <canvas ref="barChart">{{updateData()}}</canvas>
  </div>
</div>

<script src="https://unpkg.com/@microsoft/signalr@latest/dist/browser/signalr.min.js"></script>
<script src="https://unpkg.com/vue@latest/dist/vue.global.js"></script>
<script src="http://localhost:8085/dist/gameHookMapperClient.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>


<script type="text/javascript">
  const app = Vue.createApp({
    data() {
      return {
        ready: false,
        mapper: null,
        chart: null,
        chartData: {
          labels: ['HP', 'Attack', 'Defense', 'SP.ATK', 'SP.Def', 'Speed'],
          datasets: [
            {
              label: 'Active Pokemon Stats',
              data: [0,0,0,0,0,0],
              backgroundColor: [
                'rgba(255, 0, 0, 0.8)',
                'rgba(5, 5, 251, 0.8)',
                'rgba(248, 248, 5, 1)',
                'rgba(5, 248, 238, 1)',
                'rgba(163, 5, 166, 1)',
                'rgba(60, 62, 62, 0.61)',
              ],
              borderColor: [
                'rgba(255, 0, 0, 0.8)',
                'rgba(5, 5, 251, 0.8)',
                'rgba(248, 248, 5, 1)',
                'rgba(5, 248, 238, 1)',
                'rgba(163, 5, 166, 1)',
                'rgba(60, 62, 62, 0.61)',
              ],
              borderWidth: 0
            }
          ]
        }
      }
    },
    methods: {
      updateData() {
        this.chartData.datasets[0].data = [
          this.mapper.properties.player.team[0].hp,
          this.mapper.properties.player.team[0].attack,
          this.mapper.properties.player.team[0].defense,
          this.mapper.properties.player.team[0].specialAttack,
          this.mapper.properties.player.team[0].specialDefense,
          this.mapper.properties.player.team[0].speed
        ];
        if (this.chart === null) return;
        this.chart.update();
      }
    },
    mounted: async function () {
      // Setup the GameHook client, and configure it to
      // show and hide the UI based off of the ready state.
      this.mapper = new GameHookMapperClient();
      this.mapper.onConnected = (x) => this.ready = true;
      this.mapper.onDisconnected = (x) => this.ready = false;
      // Establish the connection to GameHook.
      await this.mapper.connect();

      this.chart = new Chart(this.$refs.barChart, {
        type: 'radar',
        data: this.chartData,
        options: {
          plugins: {
            customCanvasBackgroundColor: {
              color: 'white',
            }
          },
          legend: {
            display: false
          },
          tooltips: {
            callbacks: {
              label: function (tooltipItem) {
                return tooltipItem.yLabel;
              }
            }
          }
        }
      });
    },
  }).mount('#app')
</script>
</body>